# mlocks家族锁定物理内存

* 锁定物理内存，mlock家族成员有mlock,munlock,mlockall,munlockall.

* 系统调用mlock成员允许程序锁住物理内存的部分或者全部地址，这样将阻止程序将这个内存页调度到交换空间（swap space),即使程序有一段时间没有访问该空间。

* 对于实时性要求较高的程序希望锁住物理内存，内存页面调入或者调出的时间延迟可能过长或者不可预知。对于安全性要求较高的程序，内存页面调出也可能存在风险，攻击者可能恢复该页面内容。

* 锁定内存区间只需要将内存区间的开始指针和区间长度作为参数，仅仅分配内存并且使用mlock并不会使进程锁定内存，因为这段内存对应的分页可能是写时复制。可以在每个页面写入一个假的值，这样针对每个内存页面的写入操作会强制linux为当前进程分配一个独立，私有的内存页。

* 解除内存可以使用munlock,锁定全部内存使用mlockall,这个函数接受一个参数，MCL_CURRENT表示只锁定当前的内存，以后分配的内存不锁定，MCL_FUTURE表示以后分配的内存也需要锁定。

* 锁定大量的内存是危险的，剩余的进程只能抢占剩下的内存空间，并且会加快内存页面的换入换出，当linux系统将整体缺少必要内存空间的时候会杀死进程。只有超级用户权限的进程才能使用mlock和mlockall对内存资源进行锁定。munlock会将进程锁定的所有内存空间解锁，包括mlock和mlockall锁定的空间。


