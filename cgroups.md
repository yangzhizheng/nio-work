# 1.问题 
linux 下面的app多个进程抢占cpu内存等资源，造成一些重要的线程无法获得资源，导致app的频帧上不去和delay过大，解决这个问题。
# 2.*解决方法*
 * **使用cgroups技术使我们app中的所有线程独占4567四个核，其他app的线程不得使用。**
     使用脚本的方式，编写一些简单的脚本文件。
     添加全局代码
     
 * 使用linux系统中的进程优先级分类策略，将app中的一些重要线程的优先级提高。

# 3.一些系统层面和函数等层面的优化
 * 系统中的一些函数，使用cache缓存技术


# 4.cgroups相关知识

## cgroups的原理和概念
1.可以实现对一个进程或者多个进程的资源占用（比如内存资源，cpu资源）的精细化控制。

2.cgroups为每种可控制的资源定义一个子系统,称为cgroups子系统，比如cpuset子系统，memory子系统等。

3.内核中的相关控制模块把该子系统作为配置文件，实现某个进程或者某组进程对于某个资源的精细化控制。如cpu资源的控制是通过进程调度模块根据cpu子系统的配置完成的。


## cgroups层级结构
1.内核定义cgroup结构体用来表示一个control group 对一个或者多个cgroups子系统的资源限制，多个cgroup结构体组成的一种树形结构，称为一个cgroups的层级结构。

2.一个cgroup层级结构可以attach多个cgroups子系统，并且对这些子系统进行资源限制，一个子系统只能attach到一个cpu的层级结构中。

3.cgroups层级结构中的每个节点（cgroup结构体）可以设置对于资源的不同限制权重，比如cgrp1组中的进程限制使用20%的cpu时间，cgrp2组中的进程限制使用80%的cpu时间。

4.创建了cgroups层级结构中的节点（cgroup结构体）之后，可以把某个进程加入到cgroup结构体的控制任务列表中，cgroup结构体的控制任务列表中的所有进程都会受到当前节点的资源限制。由于
cgroup层级结构attach的子系统不同，一个进程可以加入到不同cgroup层级结构的节点的控制列表中。是一种多对多的关系。

## 进程与cgroups之间的关系
1.每一个进程的描述中的指针指向一个辅助的数据结构css_set,一个进程只能属于一个css_set，一个css_set包含多个进程，css_set可以对指向它的进程进行资源限制。

2.css_set通过上层的辅助数据结构可以实现与cgroups节点进行多对多的关联，但是同一个css_set不能关联到同一个cgroups层级结构的下不同节点，因为cgroups不允许对同一种资源有多个限制配置。

3.一个css_set关联到不同cgroups层级结构时表明该css_set下的进程列表需要多多个资源进行限制，一个cgroups层级结构可以关联多个css_set表明不同css_set下面进程列表的进程对于资源的限制相同。

## cgroups文件系统
  * linux使用多种数据结构在内核实现了cgroups，并且关联了cgroups节点和进程，linux如何让用户态的进程使用cgroups系统。linux内核中有一种VFS文件系统（virtual file system),可以隐藏文件的具体实现细节，向用户态进程提供一套统一的文件系统API接口，cgroups是通过VFS把功能暴露给用户，VFS和cgroups之间连接的系统称为cgroups文件系统。
### VFS
  * VFS提供给用户态进程一套统一的文件系统API,隐藏了文件系统的具体实现细节。VFS使用一种通用的文件系统，具体的文件系统只要实现了VFS的接口，就可以注册到VFS文件系统中，内核可以读写到该文件系统。（类似于面向对象设计中的抽象类和子类，抽象类负责对外接口的设计，具体的实现由子类来完成。）

## VFS通用文件模型
  四种元数据结构
  * 超级块对象：存放已经注册过的文件系统的信息，比如读取cgroups配置信息的cgroup文件系统，用于读写socket的socket文件系统。
  * 索引节点对象（inode object):存放具体文件的信息。比如inode在普通的文件系统会存储文件在硬盘上的存储块等信息，在socket系统中，inode节点会存储socket相关信息，在cgroups系统中，inode节点会存储cgroups节点的配置信息。有一种inode_operations结构体，这个结构体实现了在具体文件系统中，删除文件，创建文件等操作。
  * 文件对象：一个文件对象表示进程内打开的一个文件，文件对象是存储在进程的描述符里面的，这个系统里面比较重要的一种数据结构叫做file_operation,描述了具体文件系统的读写实现。当进程在一个文件描述符中调用读写操作的时候，实际上调用的是file_operation中的方法。普通的文件系统中，file_operation定义的就是普通块设备的读写操作。socket系统中，file_operation描述的就是socket对应的send/recv操作。在cgroups文件系统中，file_operation实现的是操作cgroup等结构体具体的实现。
  * 目录项对象：在每个文件系统中，内核在查找某个路径的文件时，会在内核路径的每一个分量上建立一个目录项对象，通过目录项对象能够找到对应的inode对象，目录项对象一般会被缓存从而提高内核查找速度。

## cgroups文件系统的实现
  基于VFS实现文件系统必须实现VFS通用模型中的定义的对象以及对象中的函数，cgroups通过实现VFS的通用文件模型，把cgroups层级结构的具体实现细节，隐藏在cgroups文件系统的这些实现函数中。

## cgroups使用方法







[Linux资源管理之cgroups简介](https://tech.meituan.com/2015/03/31/cgroups.html)



